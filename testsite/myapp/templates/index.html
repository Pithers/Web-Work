<!--myapp/templates/index.html-->
{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="grid-container">
  <div class="grid-x grid-padding-x">

    <!--Page Title-->
    <div class="cell" align="center">
      <h1>Posts</h1>
    </div>

    <div id="fetch_suggestion" class="large-10 cell">
      {% if user.is_authenticated %}
      <form action="/" method="post">
        {% csrf_token %}
        {{ form_instance }}
        <input type="submit" class="button expanded" value="Submit">
      </form>
      {% endif %}

      <div v-for="(item, index) in suggestions_list">
        <div class="card-info">
          <div class="card-info-label">
            <div class="card-info-label-text">
              #[[ index ]]
            </div>
          </div>
          <div class="card-info-content">
            <h3 class="lead">[[ item.suggestion ]]</h3>
            <p>[[ item.author ]] created on [[ item.created_on ]]</p>
            <div style="text-align:right">
              {% if user.is_authenticated %}
              <div class="button" v-bind:data-toggle="'add_comments' + index">Comment</div>
              {% else %}
              <a class="button" href="/login/">Comment</a>
              {% endif %}
              <div class="button" v-bind:data-toggle="'show_comments' + index">[[ item.comments.length ]] comments</div>
            </div>
          </div>
        </div>

        <div style="display:none" class="large-10 large-offset-2" v-bind:id="'add_comments' + index" v-foundation data-toggler data-animate="fade-in fade-out" data-options="showDelay:50;hideDelay:50">
          <div class="card-info secondary">
            <div class="card-info-content">
              <form v-bind:action="'/comment/' + item.id + '/'" method="post">
                {% csrf_token %}
                {{ comm_form }}
                <div style = "text-align:right">
                  <input type="submit" class="button" value = "Submit">
                </div>
              </form>
            </div>
          </div>
        </div>

        <div v-if="item.comments.length > 0" v-bind:id="'show_comments' + index" v-foundation data-toggler data-animate="fade-in fade-out" data-options="showDelay:50;hideDelay:50">
          <div class="grid-container">
            <div class="grid-x grid-padding-x">
              <div v-for="comment_item in item.comments" class="large-10 large-offset-2 cell">
                <div class="card-info secondary">
                  <div class="card-info-content">
                    <h3 class="lead">[[ comment_item.comment ]]</h3>
                    <p>authored by [[ comment_item.author ]] on [[ comment_item.created_on ]]</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/axios/dist/axios.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="{% static "js/my_vue.js" %}"></script>
{% endblock %}
